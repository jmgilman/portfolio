---
import { getCollection } from 'astro:content';
import Button from '@/components/ui/Button.astro';
import { formatDateShort } from '@/lib/dates';
import Icon from '@/components/ui/Icon.astro';

const featured = (await getCollection('blog'))
  .filter((post) => post.data.featured)
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf())
  .slice(0, 3);
---

<section class="bg-secondary/30 py-24">
  <div class="container mx-auto px-4">
    <!-- Section Header -->
    <div class="mb-12 flex flex-col justify-between md:flex-row md:items-end">
      <div>
        <h2 class="mb-4 text-3xl font-bold md:text-4xl">
          <span class="text-primary font-mono">//</span> Latest Posts
        </h2>
        <p class="text-muted-foreground max-w-xl">
          Thoughts on infrastructure, DevOps culture, and lessons learned along the way.
        </p>
      </div>
      <Button href="/blog" variant="ghost" class="group mt-4 md:mt-0">
        Read All Posts
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="16"
          height="16"
          viewBox="0 0 24 24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
          class="ml-2 h-4 w-4 transition-transform group-hover:translate-x-1"
          ><path d="M5 12h14"></path><path d="m12 5 7 7-7 7"></path></svg
        >
      </Button>
    </div>

    <!-- Posts Grid -->
    <div class="grid grid-cols-1 gap-6 md:grid-cols-2">
      {
        featured.map((post, index) => (
          <a
            href={`/blog/${post.id}`}
            class="group animate-fade-in block"
            style={`animation-delay: ${index * 0.1}s`}
          >
            <article class="bg-card border-border card-hover h-full rounded-lg border p-6">
              {/* Meta */}
              <div class="text-muted-foreground mb-4 flex items-center gap-4 text-sm">
                <span class="flex items-center gap-1.5">
                  <Icon name="calendar" class="h-4 w-4" />
                  {formatDateShort(post.data.date)}
                </span>
                <span class="flex items-center gap-1.5">
                  <Icon name="clock" class="h-4 w-4" />
                  {post.data.readTime}
                </span>
                <span class="bg-secondary text-muted-foreground rounded px-2 py-0.5 font-mono text-xs">
                  Topics
                </span>
              </div>

              {/* Title */}
              <h3 class="text-foreground group-hover:text-primary mb-2 text-xl font-semibold transition-colors">
                {post.data.title}
              </h3>

              {/* Excerpt */}
              <p class="text-muted-foreground mb-3 line-clamp-2">{post.data.excerpt}</p>

              {/* Tags */}
              <div class="flex flex-wrap gap-2">
                {post.data.tags.slice(0, 4).map((tag) => (
                  <span class="tag">{tag}</span>
                ))}
              </div>
            </article>
          </a>
        ))
      }
    </div>

    <!-- Subscription CTA -->
    <div
      class="border-border bg-card/70 mt-10 flex flex-col gap-4 rounded-lg border p-6 md:flex-row md:items-center md:justify-between"
    >
      <div>
        <p class="text-primary mb-1 font-mono text-sm">Stay in the loop</p>
        <p class="text-muted-foreground">
          Get new posts on reliability, DevOps culture, and cloud efficiencyâ€”sent when there's
          something worth reading.
        </p>
      </div>
      <Button href="https://linkedin.com/in/jmgilman" variant="outline">
        Follow on LinkedIn
      </Button>
    </div>
  </div>
</section>
