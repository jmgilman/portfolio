---
import Layout from '@/layouts/Layout.astro';
import Header from '@/components/Header.astro';
import Footer from '@/components/Footer.astro';
import Button from '@/components/ui/Button.astro';
import Icon from '@/components/ui/Icon.astro';
import { projects, type Project } from '@/data/projects';
import { formatMonthYear } from '@/lib/dates';

export function getStaticPaths() {
  return projects.map((project) => ({
    params: { id: project.id },
    props: { project },
  }));
}

interface Props {
  project: Project;
}

const { project } = Astro.props;

// Get related projects (same tags, excluding current)
const relatedProjects = projects
  .filter((p) => p.id !== project.id)
  .map((p) => ({
    ...p,
    sharedTags: p.tags.filter((tag) => project.tags.includes(tag)).length,
  }))
  .filter((p) => p.sharedTags > 0)
  .sort((a, b) => b.sharedTags - a.sharedTags)
  .slice(0, 2);
---

<Layout title={`${project.title} - Joshua Gilman`} description={project.description}>
  <Header slot="header" />

  <article class="py-24">
    <div class="container mx-auto px-4">
      <div class="mx-auto max-w-3xl">
        <!-- Back Button -->
        <Button href="/projects" variant="ghost" class="mb-8 -ml-2">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="16"
            height="16"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="mr-2"><path d="m12 19-7-7 7-7"></path><path d="M19 12H5"></path></svg
          >
          Back to Projects
        </Button>

        <!-- Header -->
        <header class="mb-12">
          <!-- Meta -->
          <div class="text-muted-foreground mb-6 flex flex-wrap items-center gap-4 text-sm">
            <span class="flex items-center gap-1.5">
              <Icon name="calendar" class="h-4 w-4" />
              {formatMonthYear(project.date)}
            </span>
            <span class="flex items-center gap-1.5">
              <Icon name="user" class="h-4 w-4" />
              {project.role}
            </span>
            {
              project.featured && (
                <span class="bg-primary text-primary-foreground rounded px-2 py-0.5 font-mono text-xs font-medium">
                  Featured
                </span>
              )
            }
          </div>

          <!-- Title -->
          <h1 class="mb-6 text-4xl font-bold md:text-5xl">
            {project.title}
          </h1>

          <!-- Tags -->
          <div class="flex flex-wrap gap-2">
            {project.tags.map((tag) => <span class="tag">{tag}</span>)}
          </div>
        </header>

        <!-- Impact Highlight -->
        <div class="border-primary/30 bg-primary/5 mb-10 rounded-lg border p-6">
          <h2 class="text-primary mb-2 flex items-center gap-2 font-mono text-sm">
            <Icon name="zap" class="h-4 w-4" />
            Impact
          </h2>
          <p class="text-foreground text-lg font-medium">
            {project.impact}
          </p>
        </div>

        <!-- Content -->
        <div class="prose prose-lg dark:prose-invert mb-12 max-w-none">
          <h2>Overview</h2>
          <p>{project.description}</p>

          {
            project.longDescription && (
              <>
                <h2>Details</h2>
                <p>{project.longDescription}</p>
              </>
            )
          }
        </div>

        <!-- Links -->
        {
          (project.github || project.demo) && (
            <div class="mb-12 flex flex-wrap gap-4">
              {project.github && (
                <Button
                  href={project.github}
                  variant="outline"
                  target="_blank"
                  rel="noopener noreferrer"
                >
                  <Icon name="github" class="mr-2 h-4 w-4" />
                  View on GitHub
                </Button>
              )}
              {project.demo && (
                <Button
                  href={project.demo}
                  variant="default"
                  target="_blank"
                  rel="noopener noreferrer"
                >
                  <Icon name="external" class="mr-2 h-4 w-4" />
                  View Live Demo
                </Button>
              )}
            </div>
          )
        }

        <!-- Related Projects -->
        {
          relatedProjects.length > 0 && (
            <section class="border-border mt-16 border-t pt-8">
              <h2 class="mb-6 text-xl font-semibold">Related Projects</h2>
              <div class="grid grid-cols-1 gap-4 sm:grid-cols-2">
                {relatedProjects.map((related) => (
                  <a
                    href={`/projects/${related.id}`}
                    class="group border-border bg-card hover:border-primary/50 rounded-lg border p-4 transition-colors"
                  >
                    <h3 class="text-foreground group-hover:text-primary mb-2 font-medium transition-colors">
                      {related.title}
                    </h3>
                    <p class="text-muted-foreground line-clamp-2 text-sm">{related.description}</p>
                  </a>
                ))}
              </div>
            </section>
          )
        }

        <!-- Footer -->
        <footer class="border-border mt-16 border-t pt-8">
          <Button href="/projects" variant="outline">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
              class="mr-2"><path d="m12 19-7-7 7-7"></path><path d="M19 12H5"></path></svg
            >
            Back to All Projects
          </Button>
        </footer>
      </div>
    </div>
  </article>

  <Footer slot="footer" />
</Layout>
